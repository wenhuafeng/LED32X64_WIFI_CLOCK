

#include <math.h>
#include <stdio.h>
#include <string.h>
#include "stm32f1xx_hal.h"

#include "TypeDefine.h"
#include "HUB75D.h"
#include "HTU21D.h"
#include "ESP8266_AT.h"
#include "main.h"
#include "RTC_software.h"

u16 HUB75D_DispOffCtr;

#define HUB75D_DISP_POWER_PIN    PBout(11)

HUB75D_DispTHFlag F_HUB75D_TH_DISP_CHANGE;
HUB75D_DispOnOffFlag F_HUB75D_DISP_ON_OFF;

u8 Mode;
u8 Color;
u8 fractional_frequency;

u8 COUNT=15,COUNT1,ADC_Count,LINE=15,G,T,speed;

u8 f1,f0,s1,s0,h1,h0,sd,d1,d0,m1,m0,y1,y0,wk;
u8 sign, t1, t0, td;
u8 nd1, nd0, nm1, nm0, ny1, ny0,a1, a0;
u8 zr[16], zg[16], zb[16];

extern u8 IRCOM[];

u8 const Fu_Tbl[] =
{
  0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xC1,0xC0,0x00,0x00,0x00,0x00,0x00,0x03,
  0x80,0x80,0x01,0x80,0x0F,0x80,0x00,0x01,0x80,0x80,0x00,0xF1,0xFF,0xC0,0x00,0x01,
  0x81,0xC0,0x00,0xF9,0xFF,0x80,0x87,0x85,0x83,0xE0,0x03,0xF8,0xFC,0x00,0xCF,0xCD,
  0x87,0xF0,0x07,0xD8,0x78,0x00,0xFF,0xFD,0x83,0xE0,0x00,0x00,0xFF,0x00,0x7F,0xF9,
  0x81,0xC0,0x00,0x01,0xDF,0x80,0x7F,0xF9,0x80,0x80,0x00,0x07,0xFF,0x80,0x3F,0xF1,
  0x80,0x80,0x03,0xE7,0xEF,0x80,0x1F,0xE1,0x80,0x80,0x07,0xFF,0xFF,0x00,0x07,0x81,
  0x80,0x80,0x1F,0xFD,0xFF,0x00,0x00,0x01,0x81,0x41,0xFF,0xF9,0xFF,0x00,0x00,0x01,
  0x80,0x80,0xFF,0xF8,0xFC,0x00,0x00,0x01,0x80,0x80,0xFD,0xF1,0xF0,0x00,0x00,0x01,
  0x81,0x40,0x31,0xF7,0xCF,0xE0,0x07,0x81,0x80,0x80,0x03,0xEC,0x7F,0xF8,0x1F,0xE1,
  0x80,0x80,0x07,0xCD,0xF8,0xF8,0x3F,0xF1,0x80,0x80,0x0F,0xCF,0x38,0xF8,0x3F,0xF1,
  0x83,0xE0,0x3F,0xC7,0x7E,0xF8,0x7F,0xF9,0x85,0x50,0x1F,0xC7,0xFE,0xF8,0x7C,0xF9,
  0x89,0xC8,0x1F,0xC7,0xFC,0xF0,0x7C,0xF9,0x92,0xA4,0x1F,0xC7,0x79,0xF0,0x7F,0xF9,
  0x84,0x90,0x03,0xC7,0xFD,0xF0,0x3F,0xF1,0x80,0x00,0x03,0xC3,0xFF,0xE0,0x3F,0xF1,
  0x80,0x00,0x03,0xC3,0xFF,0xE0,0x1F,0xE1,0x80,0x00,0x01,0xE0,0x07,0xC0,0x07,0x81,
  0x80,0x00,0x00,0xC0,0x03,0x80,0x00,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x01,
  0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF,0xFF
};

u8 const tab2[16][4]=
{
  {0,0,0,0},{0,6,2,5},{1,2,5,0},{1,8,7,5},
  {2,5,0,0},{3,1,2,5},{3,7,5,0},{4,3,7,5},
  {5,0,0,0},{5,6,2,5},{6,2,5,0},{6,8,7,5},
  {7,5,0,0},{8,1,2,5},{8,7,5,0},{9,3,7,5}
};

u8 const ZF[]=
{
  0x00,0x06,0x09,0x09,0x09,0x09,0x09,0x06, //0
  0x00,0x02,0x06,0x02,0x02,0x02,0x02,0x07, //1
  0x00,0x06,0x09,0x01,0x02,0x04,0x08,0x0f, //2
  0x00,0x06,0x09,0x01,0x06,0x01,0x09,0x06, //3
  0x00,0x02,0x06,0x0a,0x0a,0x0f,0x02,0x02, //4
  0x00,0x0f,0x08,0x0e,0x09,0x01,0x09,0x06, //5
  0x00,0x06,0x09,0x08,0x0e,0x09,0x09,0x06, //6
  0x00,0x0f,0x01,0x01,0x02,0x04,0x04,0x04, //7
  0x00,0x06,0x09,0x09,0x06,0x09,0x09,0x06, //8
  0x00,0x06,0x09,0x09,0x07,0x01,0x09,0x06, //9
  0x00,0x00,0x02,0x02,0x00,0x02,0x02,0x00, //10 :
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, //11 空
  0x00,0x02,0x02,0x02,0x02,0x02,0x02,0x03, //13 -
  0x00,0x00,0x00,0x02,0x07,0x02,0x00,0x00, //14 +
  0x00,0x00,0x00,0x00,0x00,0x0f,0x00,0x00, // - 15
  0x00,0x00,0x00,0x00,0x01,0x00,0x00,0x00, // . 16
  0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00, // .。 17
  0x00,0x00,0x00,0x00,0x03,0x00,0x00,0x00, // - 18
  0x00,0x00,0x80,0x00,0x30,0x40,0x40,0x30, //19 .c 4x7
};

u8 const HZ[]=
{
  0x00,0x3e,0x22,0x22,0x3e,0x22,0x22,0x3e, //0 日
  0x00,0x00,0x00,0x00,0x00,0x7e,0x00,0x00, //1 一
  0x00,0x00,0x00,0x3c,0x00,0x00,0x7e,0x00, //2 二
  0x00,0x00,0x00,0x3c,0x00,0x3c,0x00,0x7e, //3 三
  0x00,0x00,0x7f,0x55,0x55,0x77,0x41,0x7f, //4 四
  0x00,0x00,0x3e,0x08,0x3e,0x12,0x22,0x7f, //5 五
  0x00,0x08,0x00,0x7f,0x00,0x14,0x22,0x41, //6 六
  0x10,0x7c,0xa4,0xb4,0x48,0x64,0xb2,0x20, //7 农
  0x00,0x0f,0x09,0x09,0x0f,0x09,0x09,0x0f, //8 日
  0x00,0x0f,0x09,0x0f,0x09,0x0f,0x09,0x11, //9 月
  0x08,0x1f,0x24,0x1f,0x14,0x3f,0x04,0x04, //10 年
};

u8 const DateD[][8]=
{
  0x00,0x70,0x88,0x88,0x88,0x88,0x88,0x70, //0
  0x00,0x20,0x60,0x20,0x20,0x20,0x20,0x70, //1
  0x00,0x70,0x88,0x08,0x10,0x20,0x40,0xf8, //2
  0x00,0x70,0x88,0x08,0x30,0x08,0x88,0x70, //3
  0x00,0x10,0x30,0x50,0x90,0xf8,0x10,0x10, //4
  0x00,0x78,0x80,0xf0,0x08,0x08,0x88,0x70, //5
  0x00,0x70,0x80,0x80,0xf0,0x88,0x88,0x70, //6
  0x00,0xf0,0x08,0x10,0x20,0x40,0x40,0x40, //7
  0x00,0x70,0x88,0x88,0x70,0x88,0x88,0x70, //8
  0x00,0x70,0x88,0x88,0x70,0x08,0x88,0x70, //9
  0x00,0x00,0x00,0x00,0x40,0x00,0x00,0x00, //10 .
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, //11 空
  0x00,0x00,0x00,0x00,0xe0,0x00,0x00,0x00, //12 -
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x80, //13.
  0x00,0xc0,0xc0,0x30,0x48,0x40,0x48,0x30, //14 C
  0x00,0xc8,0xd0,0x20,0x58,0x98,0x00,0x00, //15 %
};

u8 const DZF[][16]=
{
  /*  --- 8x16 ---*/
  0x3c,0x7e,0xe7,0xc3,0xc3,0xc3,0xc3,0xc3,0xc3,0xc3,0xc3,0xc3,0xc3,0xe7,0x7e,0x3c, //0
  0x1c,0x7c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x1c,0x7f, //1
  0x3c,0x7e,0xe7,0xc3,0xc3,0xc3,0x03,0x03,0x07,0x0e,0x1c,0x38,0x70,0xe1,0xff,0xff, //2
  0x3c,0x7e,0xe7,0xc3,0x03,0x03,0x03,0x3e,0x3e,0x03,0x03,0x03,0xc3,0xe7,0x7e,0x3c, //3
  0x0c,0x0c,0x1c,0x1c,0x3c,0x3c,0x6c,0x6c,0xcc,0xcc,0x8c,0xff,0xff,0x0c,0x0c,0x1e, //4
  0x7e,0xff,0xc0,0xc0,0xc0,0xc0,0xfc,0xfe,0x07,0x03,0x03,0x03,0xc3,0xe7,0x7e,0x3c, //5
  0x3c,0x7e,0xe7,0xc3,0xc0,0xc0,0xc0,0xfc,0xfe,0xe7,0xc3,0xc3,0xc3,0xe7,0x7e,0x3c, //6
  0x7e,0xff,0xc3,0x83,0x03,0x03,0x06,0x06,0x0c,0x0c,0x18,0x18,0x18,0x18,0x18,0x3c, //7
  0x3c,0x7e,0xe7,0xc3,0xc3,0xc3,0xe7,0x7e,0x7e,0xe7,0xc3,0xc3,0xc3,0xe7,0x7e,0x3c, //8
  0x3c,0x7e,0xe7,0xc3,0xc3,0xc3,0xe7,0x7f,0x3f,0x03,0x03,0xc3,0xc3,0xe7,0x7e,0x3c, //9
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, //10
  0x00,0x00,0x18,0x24,0x24,0x18,0x00,0x00,0x00,0x00,0x18,0x24,0x24,0x18,0x00,0x00, //11 SD
  0x00,0x3f,0x21,0x21,0x21,0x3f,0x21,0x21,0x21,0x3f,0x21,0x21,0x21,0x21,0x45,0x82, //12 月
  0x00,0x00,0x7f,0x41,0x41,0x41,0x41,0x7f,0x41,0x41,0x41,0x41,0x41,0x7f,0x41,0x00, //13 日
  0x00,0x7f,0x41,0x49,0x5d,0x49,0x5d,0x41,0x5d,0x55,0x55,0x5d,0x55,0x41,0x41,0x82, //14 周
  0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x7f,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, //15 一
  0x00,0x00,0x00,0x00,0x00,0x02,0x7e,0x00,0x00,0x00,0x00,0x01,0xff,0x00,0x00,0x00, //16 二
  0x00,0x00,0x02,0x7e,0x00,0x00,0x02,0x7e,0x00,0x00,0x00,0x01,0xff,0x00,0x00,0x00, //17 三
  0x00,0x00,0x02,0x7e,0x00,0x00,0x02,0x7e,0x00,0x00,0x00,0x01,0xff,0x00,0x00,0x00, //18 四
  0x00,0x00,0x7e,0x08,0x08,0x08,0x0a,0x7e,0x12,0x12,0x12,0x22,0x22,0xff,0x00,0x00, //19 五
  0x00,0x20,0x18,0x0c,0x08,0xff,0x00,0x00,0x24,0x34,0x24,0x46,0x43,0x83,0x82,0x00, //20 六
  0x00,0x00,0x10,0x10,0x10,0x1f,0xf0,0x10,0x10,0x10,0x10,0x10,0x11,0x11,0x0e,0x00, //21 七
  0x00,0x00,0x04,0x26,0x34,0x24,0x24,0x24,0x24,0x66,0x62,0x62,0x83,0x83,0x81,0x00, //22 八
  0x00,0x20,0x20,0x20,0x20,0xfc,0x24,0x24,0x24,0x24,0x44,0x44,0x45,0x85,0x86,0x00, //23 九
  0x00,0x10,0x10,0x10,0x10,0x10,0x10,0xfe,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x00, //24 十
  0x00,0x44,0x44,0x44,0x44,0x44,0x44,0xfe,0x44,0x44,0x44,0x44,0x44,0x44,0x7e,0x00, //25 廿
  0x00,0x00,0x54,0x54,0x54,0x54,0x54,0xfe,0x54,0x54,0x54,0x54,0x54,0x54,0x54,0x00, //26 卅
  0x00,0x00,0xe1,0xa1,0xe2,0x02,0x04,0x04,0x08,0x10,0x20,0x20,0x40,0x47,0x85,0x87, //27 %
  0x00,0x00,0xe0,0xa0,0xe0,0x00,0x1e,0x23,0x41,0x40,0x40,0x40,0x40,0x41,0x23,0x1e, //28 c
};

u8 const ZZF[][16]=
{
  0x00,0x00,0x3e,0x7f,0x63,0x63,0x63,0x63, 0x63, 0x63, 0x63, 0x63, 0x7f, 0x3e, 0x00, 0x00, //0
  0x00,0x00,0x1c,0x3c,0x1c,0x1c,0x1c,0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x1c, 0x3e, 0x00, 0x00, //1
  0x00,0x00,0x3e,0x7f,0x63,0x63,0x07,0x0e, 0x1c, 0x38, 0x70, 0x60, 0x7f, 0x7f, 0x00, 0x00, //2
  0x00,0x00,0x3e,0x7f,0x63,0x63,0x03,0x06, 0x06, 0x03, 0x63, 0x63, 0x7f, 0x3e, 0x00, 0x00, //3
  0x00,0x00,0x1e,0x1e,0x36,0x36,0x36,0x66, 0x66, 0x7f, 0x7f, 0x06, 0x06, 0x06, 0x00, 0x00, //4
  0x00,0x00,0x3f,0x7f,0x60,0x60,0x60,0x7e, 0x3f, 0x03, 0x03, 0x63, 0x7f, 0x3e, 0x00, 0x00, //5
  0x00,0x00,0x3e,0x7f,0x63,0x60,0x60,0x7e, 0x7f, 0x63, 0x63, 0x63, 0x7f, 0x3e, 0x00, 0x00, //6
  0x00,0x00,0x3e,0x7f,0x63,0x63,0x03,0x06, 0x06, 0x06, 0x0c, 0x0c, 0x0c, 0x0c, 0x00, 0x00, //7
  0x00,0x00,0x3e,0x7f,0x63,0x63,0x63,0x3e, 0x3e, 0x63, 0x63, 0x63, 0x7f, 0x3e, 0x00, 0x00, //8
  0x00,0x00,0x3e,0x7f,0x63,0x63,0x63,0x7f, 0x3f, 0x03, 0x03, 0x63, 0x7f, 0x3e, 0x00, 0x00, //9
  0x00,0x00,0x00,0x00,0x00,0x06,0x06,0x00, 0x00, 0x06, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, //10 :
  0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, //11
};

//二维数据16x16
u8 const hanzi[28][32] = {
    0x1F,0xF8,0x01,0x00,0x7F,0xFE,0x41,0x04,0x1D,0x70,0x01,0x00,0x1D,0x70,0x02,0x80, /* 零 */
    0x04,0x60,0x1A,0x1E,0xE1,0x08,0x1F,0xE0,0x00,0x40,0x02,0x80,0x01,0x00,0x01,0x00,
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x7F,0xFE, /* 一 */
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x10,0x3F,0xF8,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00, /* 二 */
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x04,0x7F,0xFE,0x00,0x00,0x00,0x00,0x00,0x00,
    0x00,0x00,0x00,0x00,0x7F,0xFC,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x3F,0xF8, /* 三 */
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x7F,0xFE,0x00,0x00,0x00,0x00,
    0x00,0x00,0x7F,0xFC,0x44,0x84,0x44,0x84,0x44,0x84,0x44,0x84,0x44,0x84,0x44,0x84, /* 四 */
    0x48,0x84,0x48,0x7C,0x50,0x04,0x60,0x04,0x40,0x04,0x7F,0xFC,0x40,0x04,0x00,0x00,
    0x00,0x00,0x7F,0xF8,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x20,0x3F,0xF0, /* 五 */
    0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x24,0xFF,0xFE,0x00,0x00,0x00,0x00,
    0x04,0x00,0x03,0x00,0x01,0x80,0x01,0x00,0xFF,0xFE,0x00,0x00,0x00,0x00,0x04,0x80, /* 六 */
    0x06,0x40,0x04,0x20,0x08,0x10,0x08,0x18,0x10,0x0C,0x20,0x0C,0x40,0x08,0x00,0x00,
    0x00,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0xFE,0x7F,0x00,0x01,0x00, /* 七 */
    0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x04,0x01,0x04,0x01,0x04,0x00,0xF8,0x00,0x00,
    0x00,0x00,0x00,0x40,0x04,0x60,0x06,0x40,0x04,0x40,0x04,0x40,0x04,0x40,0x08,0x20, /* 八 */
    0x08,0x20,0x10,0x10,0x10,0x10,0x20,0x08,0x40,0x0E,0x80,0x04,0x00,0x00,0x00,0x00,
    0x02,0x00,0x02,0x00,0x02,0x00,0x02,0x20,0x7F,0xF0,0x02,0x20,0x02,0x20,0x04,0x20, /* 九 */
    0x04,0x20,0x04,0x20,0x08,0x20,0x08,0x24,0x10,0x24,0x20,0x26,0x40,0x3C,0x00,0x00,
    0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0xFF,0xFE,0x01,0x00, /* 十 */
    0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x01,0x00,0x00,0x00,
    0x08,0x00,0x0F,0xFC,0x10,0x80,0x10,0x80,0x20,0x80,0x4F,0xF8,0x88,0x80,0x08,0x80, /* 年 */
    0x08,0x80,0x08,0x80,0xFF,0xFE,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,0x00,0x80,
    0x07,0xF0,0x04,0x10,0x04,0x10,0x04,0x10,0x07,0xF0,0x04,0x10,0x04,0x10,0x04,0x10, /* 月 */
    0x07,0xF0,0x04,0x10,0x08,0x10,0x08,0x10,0x10,0x10,0x20,0x50,0x40,0x20,0x00,0x00,
    0x00,0x00,0x1F,0xF0,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x1F,0xF0,0x10,0x10, /* 日 */
    0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x10,0x1F,0xF0,0x10,0x10,0x00,0x00,0x00,0x00,
    0x00,0x00,0x1F,0xF8,0x10,0x08,0x1F,0xF8,0x10,0x08,0x1F,0xF8,0x01,0x00,0x11,0x00, /* 星 */
    0x1F,0xFC,0x21,0x00,0x21,0x00,0x4F,0xF8,0x01,0x00,0x01,0x00,0x7F,0xFE,0x00,0x00,
    0x22,0x00,0x22,0x7C,0x7F,0x44,0x22,0x44,0x3E,0x44,0x22,0x7C,0x3E,0x44,0x22,0x44, /* 期 */
    0x22,0x44,0xFF,0x7C,0x00,0x44,0x24,0x84,0x22,0x84,0x43,0x14,0x81,0x08,0x00,0x00,
    0x00,0x10,0x00,0x10,0x7C,0x10,0x44,0x10,0x47,0xFE,0x44,0x10,0x7C,0x10,0x45,0x10, /* 时 */
    0x44,0x90,0x44,0x90,0x7C,0x10,0x00,0x10,0x00,0x10,0x00,0x10,0x00,0x50,0x00,0x20,
    0x00,0x80,0x0C,0x80,0x08,0x40,0x10,0x20,0x10,0x30,0x20,0x18,0x40,0x0E,0x9F,0xE4, /* 分 */
    0x04,0x20,0x04,0x20,0x04,0x20,0x04,0x20,0x08,0x20,0x10,0xA0,0x20,0x40,0x40,0x00,
    0x00,0x00,0x1F,0xFC,0x10,0x84,0x13,0xE4,0x10,0x84,0x10,0x84,0x17,0xF4,0x10,0x04, /* 周 */
    0x13,0xE4,0x12,0x24,0x12,0x24,0x13,0xE4,0x22,0x24,0x20,0x04,0x40,0x14,0x80,0x08,
    0x02,0x00,0x01,0x00,0x3F,0xFE,0x20,0x04,0x40,0x08,0x1F,0xF0,0x01,0x00,0x11,0x00, /* 定 */
    0x11,0x00,0x11,0xF0,0x11,0x00,0x29,0x00,0x25,0x00,0x43,0x00,0x81,0xFC,0x00,0x00,
    0x00,0x00,0x47,0xFC,0x24,0x44,0x24,0x44,0x05,0xF4,0x04,0x44,0xE4,0x44,0x27,0xFC, /* 调 */
    0x24,0x04,0x25,0xF4,0x25,0x14,0x2D,0x14,0x35,0xF4,0x24,0x04,0x04,0x14,0x08,0x08,
    0x08,0x20,0x08,0x20,0xFF,0xBE,0x08,0x44,0x7F,0xA4,0x49,0x24,0x7F,0x28,0x2A,0x10, /* 整 */
    0x49,0x28,0x88,0x46,0x00,0x00,0x7F,0xFC,0x01,0x00,0x11,0xF8,0x11,0x00,0xFF,0xFE,
    0x10,0x40,0x10,0x40,0x10,0x40,0x13,0xF8,0x18,0x48,0x54,0x48,0x50,0x48,0x50,0x48, /* 快 */
    0x97,0xFE,0x10,0x40,0x10,0xA0,0x10,0xA0,0x11,0x10,0x11,0x10,0x12,0x08,0x14,0x06,
    0x23,0xF8,0x22,0x08,0x23,0xF8,0x32,0x08,0xAB,0xF8,0xA0,0x00,0xA7,0xFC,0xA4,0xA4, /* 慢 */
    0x24,0xA4,0x27,0xFC,0x20,0x00,0x23,0xF8,0x21,0x10,0x20,0xE0,0x23,0x18,0x2C,0x06,
};

/*------------农历程序-------------------------*/
const u8 year_code[597] = {
  0x04,0xAe,0x53,    //1901 0
  0x0A,0x57,0x48,    //1902 3
  0x55,0x26,0xBd,    //1903 6
  0x0d,0x26,0x50,    //1904 9
  0x0d,0x95,0x44,    //1905 12
  0x46,0xAA,0xB9,    //1906 15
  0x05,0x6A,0x4d,    //1907 18
  0x09,0xAd,0x42,    //1908 21
  0x24,0xAe,0xB6,    //1909
  0x04,0xAe,0x4A,    //1910
  0x6A,0x4d,0xBe,    //1911
  0x0A,0x4d,0x52,    //1912
  0x0d,0x25,0x46,    //1913
  0x5d,0x52,0xBA,    //1914
  0x0B,0x54,0x4e,    //1915
  0x0d,0x6A,0x43,    //1916
  0x29,0x6d,0x37,    //1917
  0x09,0x5B,0x4B,    //1918
  0x74,0x9B,0xC1,    //1919
  0x04,0x97,0x54,    //1920
  0x0A,0x4B,0x48,    //1921
  0x5B,0x25,0xBC,    //1922
  0x06,0xA5,0x50,    //1923
  0x06,0xd4,0x45,    //1924
  0x4A,0xdA,0xB8,    //1925
  0x02,0xB6,0x4d,    //1926
  0x09,0x57,0x42,    //1927
  0x24,0x97,0xB7,    //1928
  0x04,0x97,0x4A,    //1929
  0x66,0x4B,0x3e,    //1930
  0x0d,0x4A,0x51,    //1931
  0x0e,0xA5,0x46,    //1932
  0x56,0xd4,0xBA,    //1933
  0x05,0xAd,0x4e,    //1934
  0x02,0xB6,0x44,    //1935
  0x39,0x37,0x38,    //1936
  0x09,0x2e,0x4B,    //1937
  0x7C,0x96,0xBf,    //1938
  0x0C,0x95,0x53,    //1939
  0x0d,0x4A,0x48,    //1940
  0x6d,0xA5,0x3B,    //1941
  0x0B,0x55,0x4f,    //1942
  0x05,0x6A,0x45,    //1943
  0x4A,0xAd,0xB9,    //1944
  0x02,0x5d,0x4d,    //1945
  0x09,0x2d,0x42,    //1946
  0x2C,0x95,0xB6,    //1947
  0x0A,0x95,0x4A,    //1948
  0x7B,0x4A,0xBd,    //1949
  0x06,0xCA,0x51,    //1950
  0x0B,0x55,0x46,    //1951
  0x55,0x5A,0xBB,    //1952
  0x04,0xdA,0x4e,    //1953
  0x0A,0x5B,0x43,    //1954
  0x35,0x2B,0xB8,    //1955
  0x05,0x2B,0x4C,    //1956
  0x8A,0x95,0x3f,    //1957
  0x0e,0x95,0x52,    //1958
  0x06,0xAA,0x48,    //1959
  0x7A,0xd5,0x3C,    //1960
  0x0A,0xB5,0x4f,    //1961
  0x04,0xB6,0x45,    //1962
  0x4A,0x57,0x39,    //1963
  0x0A,0x57,0x4d,    //1964
  0x05,0x26,0x42,    //1965
  0x3e,0x93,0x35,    //1966
  0x0d,0x95,0x49,    //1967
  0x75,0xAA,0xBe,    //1968
  0x05,0x6A,0x51,    //1969
  0x09,0x6d,0x46,    //1970
  0x54,0xAe,0xBB,    //1971
  0x04,0xAd,0x4f,    //1972
  0x0A,0x4d,0x43,    //1973
  0x4d,0x26,0xB7,    //1974
  0x0d,0x25,0x4B,    //1975
  0x8d,0x52,0xBf,    //1976
  0x0B,0x54,0x52,    //1977
  0x0B,0x6A,0x47,    //1978
  0x69,0x6d,0x3C,    //1979
  0x09,0x5B,0x50,    //1980
  0x04,0x9B,0x45,    //1981
  0x4A,0x4B,0xB9,    //1982
  0x0A,0x4B,0x4d,    //1983
  0xAB,0x25,0xC2,    //1984
  0x06,0xA5,0x54,    //1985
  0x06,0xd4,0x49,    //1986
  0x6A,0xdA,0x3d,    //1987
  0x0A,0xB6,0x51,    //1988
  0x09,0x37,0x46,    //1989
  0x54,0x97,0xBB,    //1990
  0x04,0x97,0x4f,    //1991
  0x06,0x4B,0x44,    //1992
  0x36,0xA5,0x37,    //1993
  0x0e,0xA5,0x4A,    //1994
  0x86,0xB2,0xBf,    //1995
  0x05,0xAC,0x53,    //1996
  0x0A,0xB6,0x47,    //1997
  0x59,0x36,0xBC,    //1998
  0x09,0x2e,0x50,    //1999 294
  0x0C,0x96,0x45,    //2000 297
  0x4d,0x4A,0xB8,    //2001
  0x0d,0x4A,0x4C,    //2002
  0x0d,0xA5,0x41,    //2003
  0x25,0xAA,0xB6,    //2004
  0x05,0x6A,0x49,    //2005
  0x7A,0xAd,0xBd,    //2006
  0x02,0x5d,0x52,    //2007
  0x09,0x2d,0x47,    //2008
  0x5C,0x95,0xBA,    //2009
  0x0A,0x95,0x4e,    //2010
  0x0B,0x4A,0x43,    //2011
  0x4B,0x55,0x37,    //2012
  0x0A,0xd5,0x4A,    //2013
  0x95,0x5A,0xBf,    //2014
  0x04,0xBA,0x53,    //2015
  0x0A,0x5B,0x48,    //2016
  0x65,0x2B,0xBC,    //2017
  0x05,0x2B,0x50,    //2018
  0x0A,0x93,0x45,    //2019
  0x47,0x4A,0xB9,    //2020
  0x06,0xAA,0x4C,    //2021
  0x0A,0xd5,0x41,    //2022
  0x24,0xdA,0xB6,    //2023
  0x04,0xB6,0x4A,    //2024
  0x69,0x57,0x3d,    //2025
  0x0A,0x4e,0x51,    //2026
  0x0d,0x26,0x46,    //2027
  0x5e,0x93,0x3A,    //2028
  0x0d,0x53,0x4d,    //2029
  0x05,0xAA,0x43,    //2030
  0x36,0xB5,0x37,    //2031
  0x09,0x6d,0x4B,    //2032
  0xB4,0xAe,0xBf,    //2033
  0x04,0xAd,0x53,    //2034
  0x0A,0x4d,0x48,    //2035
  0x6d,0x25,0xBC,    //2036
  0x0d,0x25,0x4f,    //2037
  0x0d,0x52,0x44,    //2038
  0x5d,0xAA,0x38,    //2039
  0x0B,0x5A,0x4C,    //2040
  0x05,0x6d,0x41,    //2041
  0x24,0xAd,0xB6,    //2042
  0x04,0x9B,0x4A,    //2043
  0x7A,0x4B,0xBe,    //2044
  0x0A,0x4B,0x51,    //2045
  0x0A,0xA5,0x46,    //2046
  0x5B,0x52,0xBA,    //2047
  0x06,0xd2,0x4e,    //2048
  0x0A,0xdA,0x42,    //2049
  0x35,0x5B,0x37,    //2050
  0x09,0x37,0x4B,    //2051
  0x84,0x97,0xC1,    //2052
  0x04,0x97,0x53,    //2053
  0x06,0x4B,0x48,    //2054
  0x66,0xA5,0x3C,    //2055
  0x0e,0xA5,0x4f,    //2056
  0x06,0xB2,0x44,    //2057
  0x4A,0xB6,0x38,    //2058
  0x0A,0xAe,0x4C,    //2059
  0x09,0x2e,0x42,    //2060
  0x3C,0x97,0x35,    //2061
  0x0C,0x96,0x49,    //2062
  0x7d,0x4A,0xBd,    //2063
  0x0d,0x4A,0x51,    //2064
  0x0d,0xA5,0x45,    //2065
  0x55,0xAA,0xBA,    //2066
  0x05,0x6A,0x4e,    //2067
  0x0A,0x6d,0x43,    //2068
  0x45,0x2e,0xB7,    //2069
  0x05,0x2d,0x4B,    //2070
  0x8A,0x95,0xBf,    //2071
  0x0A,0x95,0x53,    //2072
  0x0B,0x4A,0x47,    //2073
  0x6B,0x55,0x3B,    //2074
  0x0A,0xd5,0x4f,    //2075
  0x05,0x5A,0x45,    //2076
  0x4A,0x5d,0x38,    //2077
  0x0A,0x5B,0x4C,    //2078
  0x05,0x2B,0x42,    //2079
  0x3A,0x93,0xB6,    //2080
  0x06,0x93,0x49,    //2081
  0x77,0x29,0xBd,    //2082
  0x06,0xAA,0x51,    //2083
  0x0A,0xd5,0x46,    //2084
  0x54,0xdA,0xBA,    //2085
  0x04,0xB6,0x4e,    //2086
  0x0A,0x57,0x43,    //2087
  0x45,0x27,0x38,    //2088
  0x0d,0x26,0x4A,    //2089
  0x8e,0x93,0x3e,    //2090
  0x0d,0x52,0x52,    //2091
  0x0d,0xAA,0x47,    //2092
  0x66,0xB5,0x3B,    //2093
  0x05,0x6d,0x4f,    //2094
  0x04,0xAe,0x45,    //2095
  0x4A,0x4e,0xB9,    //2096
  0x0A,0x4d,0x4C,    //2097
  0x0d,0x15,0x41,    //2098
  0x2d,0x92,0xB5,    //2099
};

const u8 day_code1[9] = {0x0,0x1f,0x3b,0x5a,0x78,0x97,0xb5,0xd4,0xf3};
const u16 day_code2[3] = {0x111,0x130,0x14e};

//BOOLEAN c_moon;
u8 year_moon,month_moon,day_moon;

u8 get_moon_day(u8 month_p,u16 table_addr)
{
  u8 temp;

  switch (month_p){
    case 1:{temp=year_code[table_addr]&0x08;if (temp==0)return(0);else return(1);}
    case 2:{temp=year_code[table_addr]&0x04;if (temp==0)return(0);else return(1);}
    case 3:{temp=year_code[table_addr]&0x02;if (temp==0)return(0);else return(1);}
    case 4:{temp=year_code[table_addr]&0x01;if (temp==0)return(0);else return(1);}
    case 5:{temp=year_code[table_addr+1]&0x80;if (temp==0)return(0);else return(1);}
    case 6:{temp=year_code[table_addr+1]&0x40;if (temp==0)return(0);else return(1);}
    case 7:{temp=year_code[table_addr+1]&0x20;if (temp==0)return(0);else return(1);}
    case 8:{temp=year_code[table_addr+1]&0x10;if (temp==0)return(0);else return(1);}
    case 9:{temp=year_code[table_addr+1]&0x08;if (temp==0)return(0);else return(1);}
    case 10:{temp=year_code[table_addr+1]&0x04;if (temp==0)return(0);else return(1);}
    case 11:{temp=year_code[table_addr+1]&0x02;if (temp==0)return(0);else return(1);}
    case 12:{temp=year_code[table_addr+1]&0x01;if (temp==0)return(0);else return(1);}
    case 13:{temp=year_code[table_addr+2]&0x80;if (temp==0)return(0);else return(1);}
  }

  return 0;
}

u8 _cror_(u8 temp,u8 n)
{
  u8 i,j;

  for (i=n; i>0; i--)
  {
    j = 0;
    if (temp & 0x01) {
        j = 0x80;
    }
    temp = temp >> 1;
    temp |= j;
  }

  return temp;
}

u8 _crol_(u8 temp,u8 n)
{
  u8 i,j;

  for (i=n; i>0; i--)
  {
    j = 0;
    if (temp & 0x80) {
        j = 0x01;
    }
    temp = temp << 1;
    temp |= j;
  }

  return temp;
}

void Conversion(u8 c,u8 year,u8 month,u8 day)
{
  u8 temp1,temp2,temp3,month_p;
  u16 temp4,table_addr;
  u8 flag2,flag_y;

  temp1 = year/10;
  temp2 = year%10;
  year = temp1*10+temp2;
  temp1 = month/10;
  temp2 = month%10;
  month = temp1*10+temp2;
  temp1 = day/10;
  temp2 = day%10;
  day = temp1*10+temp2;

  if (c==0){
    table_addr = (year+0x64-1)*0x3;
  }
  else {
    table_addr = (year-1)*0x03;
  }

  temp1 = year_code[table_addr+2]&0x60;
  temp1 = _cror_(temp1,5);
  temp2 = year_code[table_addr+2]&0x1f;

  if (temp1==0x1) {
    temp3 = temp2-1;
  }
  else{
    temp3 = temp2+0x1f-1;
  }

  if (month<10) {
    temp4 = day_code1[month-1]+day-1;
  }
  else{
    temp4 = day_code2[month-10]+day-1;
  }
  if ((month>0x2)&&(year%0x4==0)) {
    temp4 += 1;
  }

  if (temp4 >= temp3) {
    temp4 -= temp3;
    month = 0x1;
    month_p = 0x1;
    flag2 = get_moon_day(month_p,table_addr);
    flag_y = 0;
    if (flag2==0) temp1 = 0x1d;
    else temp1=0x1e;
    temp2 = year_code[table_addr]&0xf0;
    temp2 = _cror_(temp2,4);
    while (temp4>=temp1) {
      temp4 -= temp1;
      month_p += 1;
      if (month==temp2) {
        flag_y = ~flag_y;
        if (flag_y==0) month += 1;
      }
      else month += 1;
      flag2 = get_moon_day(month_p,table_addr);
      if (flag2==0) temp1 = 0x1d;
      else temp1 = 0x1e;
    }
    day = temp4+1;
  }
  else{
    temp3 -= temp4;
    if (year==0x0) {year=0x63;c=1;}
    else year -= 1;
    table_addr -= 0x03;
    month = 0xc;
    temp2 = year_code[table_addr]&0xf0;
    temp2 = _cror_(temp2,4);
    if (temp2==0) month_p = 0xc;
    else month_p = 0xd;

    flag_y = 0;
    flag2 = get_moon_day(month_p,table_addr);
    if (flag2==0) temp1 = 0x1d;
    else temp1 = 0x1e;
    while (temp3>temp1) {
      temp3 -= temp1;
      month_p -= 1;
      if (flag_y==0) month -= 1;
      if (month==temp2) flag_y = ~flag_y;
      flag2 = get_moon_day(month_p,table_addr);
      if (flag2==0) temp1 = 0x1d;
      else temp1 = 0x1e;
    }
    day = temp1-temp3+1;
  }

  temp1 = year/10;
  temp1 = _crol_(temp1,4);
  temp2 = year%10;
  year_moon = temp1|temp2;
  temp1 = month/10;
  temp1 = _crol_(temp1,4);
  temp2 = month%10;
  month_moon = temp1|temp2;
  temp1 = day/10;
  temp1 = _crol_(temp1,4);
  temp2 = day%10;
  day_moon = temp1|temp2;
}

void HUB75D_CalcYinli(rtc_counter_value_t *time)
{
  u8 dd= time->day;
  u8 mo= time->month;
  u8 yy= time->year%100;

  Conversion(0,yy,mo,dd);
  ny1 = (year_moon&0x70)>>4;
  ny0 = year_moon&0x0F;
  nm1 = (month_moon&0x70)>>4;
  nm0 = month_moon&0x0F;
  nd1 = (day_moon&0x70)>>4;
  nd0 = day_moon&0x0F;
}

void DispTime(u8 i)
{
  if (h1==0) {
    h1 = 10;
  }
  if (f1>=4) {
    zr[0]|=DZF[h1][i];  //h1
    zg[0]|=DZF[h1][i];  //h1
    zb[0]|=DZF[h1][i];  //h1
    zr[1]|=(DZF[h0][i]>>1);     //h0
    zr[2]|=(DZF[h0][i]<<7);     //h0
    zg[1]|=(DZF[h0][i]>>1);     //h0
    zg[2]|=(DZF[h0][i]<<7);     //h0
    zb[1]|=(DZF[h0][i]>>1);     //h0
    zb[2]|=(DZF[h0][i]<<7);     //h0
    zr[2]|=DZF[sd][i];  //sd
    zb[2]|=DZF[sd][i];  //sd
    zr[3]|=DZF[f1][i];  //f1
    zg[3]|=DZF[f1][i];  //f1
    zb[3]|=DZF[f1][i];  //f1
    zr[4]|=(DZF[f0][i]>>1);     //f0
    zr[5]|=(DZF[f0][i]<<7);     //f0
    zg[4]|=(DZF[f0][i]>>1);     //f0
    zg[5]|=(DZF[f0][i]<<7);     //f0
    zb[4]|=(DZF[f0][i]>>1);     //f0
    zb[5]|=(DZF[f0][i]<<7);     //f0
    zr[5]|=DZF[sd][i];  //sd
    zb[5]|=DZF[sd][i];  //sd
    zr[6]|=ZZF[s1][i];  //s1
    zg[6]|=ZZF[s1][i];  //s1
    zb[6]|=ZZF[s1][i];  //s1
    zr[7]|=ZZF[s0][i];  //s0
    zg[7]|=ZZF[s0][i];  //s0
    zb[7]|=ZZF[s0][i];  //s0
  }
  else if (f1>=2) {
    zg[0]|=DZF[h1][i];  //h1
    zg[1]|=(DZF[h0][i]>>1);     //h0
    zg[2]|=(DZF[h0][i]<<7);     //h0
    zr[2]|=DZF[sd][i];  //sd
    zg[2]|=DZF[sd][i];  //sd
    zg[3]|=DZF[f1][i];  //f1
    zg[4]|=(DZF[f0][i]>>1);     //f0
    zg[5]|=(DZF[f0][i]<<7);     //f0
    zr[5]|=DZF[sd][i];  //sd
    zg[5]|=DZF[sd][i];  //sd
    zg[6]|=ZZF[s1][i];  //s1
    zg[7]|=ZZF[s0][i];  //s0
  }
  else {
    zr[0] |= DZF[h1][i];        //h1
    zg[0] |= DZF[h1][i];
    //zb[0] |= DZF[h1][i];
    zr[1] |= (DZF[h0][i]>>1);   //h0
    zg[1] |= (DZF[h0][i]>>1);
    //zb[1] |= (DZF[h0][i]>>1);
    zr[2] |= (DZF[h0][i]<<7);   //h0
    zg[2] |= (DZF[h0][i]<<7);
    //zb[2] |= (DZF[h0][i]<<7);
    zg[2] |= DZF[sd][i];        //sd
    zr[3] |= DZF[f1][i];        //f1
    zg[3] |= DZF[f1][i];
    //zb[3] |= DZF[f1][i];
    zr[4] |= (DZF[f0][i]>>1);   //f0
    zg[4] |= (DZF[f0][i]>>1);
    //zb[4] |= (DZF[f0][i]>>1);
    zr[5] |= (DZF[f0][i]<<7);   //f0
    zg[5] |= (DZF[f0][i]<<7);
    //zb[5] |= (DZF[f0][i]<<7);
    zg[5] |= DZF[sd][i];        //sd
    zr[6] |= ZZF[s1][i];        //s1
    zg[6] |= ZZF[s1][i];
    //zb[6] |= ZZF[s1][i];
    zr[7] |= ZZF[s0][i];        //s0
    zg[7] |= ZZF[s0][i];
    //zb[7]|= ZZF[s0][i];
  }
}

void DispDate(u8 i)
{
  u8 k;

  if (f1>=2) {
    zg[8]|=(ZF[2*8+i]<<4);      //2		8-5 前4列，6列空
    zg[8]|=(ZF[0*8+i]>>1);      //0, 前3位	8-8
    zg[9]|=(ZF[0*8+i]<<7);      //0, 后1位	9-3  4列空
    zg[9]|=(ZF[y1*8+i]<<2);     //y1 前4位	9-8  5列空
    zg[9]|=(ZF[y0*8+i]>>3);     //y0 前1位	10-1 2列空
    for (k=8; k<10; k++) {
      zr[k]=zg[k];      // 黄色
    }
    zg[10]|=(ZF[y0*8+i]<<5);    //y0 前3位	10-3  12列空
    zr[10]|=(ZF[y0*8+i]<<5);    //黄色

    zg[10]|=(HZ[10*8+i]>>2);    //年 ,		10-8
    zg[11]|=(HZ[10*8+i]<<6);    //年 ,		11-2
    if (m1==0) {
      m1=11;
    }
    zg[11]|=(ZF[m1*8+i]<<1);    //m1 3位	11-7
    zr[11]|=(ZF[m1*8+i]<<1);    // 黄色
    zg[12]|=(ZF[m0*8+i]<<4);    //m9 5	12-4
    zr[12]|=(ZF[m0*8+i]<<4);    // 黄色

    zg[12]|=(HZ[9*8+i]>>1);     //月 前4位	12-8 后5列
    zg[13]|=(HZ[9*8+i]<<7);     //月 后1位	13-11
    if (d1==0) {
      d1=11;
    }
    zg[13]|=(ZF[d1*8+i]<<2);    //d1 前3位	13-76   前5列
    zr[13]|=(ZF[d1*8+i]<<2);    // 黄色
    zg[13]|=(ZF[d0*8+i]>>3);    //d0  		14-5
    zr[13]|=(ZF[d0*8+i]>>3);    // 黄色
    zg[14]|=(ZF[d0*8+i]<<5);    //d0  		14 3
    zr[14]|=(ZF[d0*8+i]<<5);    // 黄色

    zg[14]|=(HZ[8*8+i]);        //日 后4位	14-88
    //for (k=8; k<15; k++) zr[k]=zg[k];	// 黄色
    zr[15]|=HZ[(wk-0)*8+i];     //week		15-3~15-8
  } else {
    zg[8]|=(ZF[2*8+i]<<4);      //2		8-5 前4列，6列空
    zg[8]|=(ZF[0*8+i]>>1);      //0, 前3位	8-8
    zg[9]|=(ZF[0*8+i]<<7);      //0, 后1位	9-3  4列空
    zg[9]|=(ZF[y1*8+i]<<2);     //y1 前4位	9-8  5列空
    zg[9]|=(ZF[y0*8+i]>>3);     //y0 前1位	10-1 2列空
    zg[10]|=(ZF[y0*8+i]<<5);    //y0 前3位	10-3  12列空

    zr[10]|=(HZ[10*8+i]>>2);    //年 ,		10-8
    zr[11]|=(HZ[10*8+i]<<6);    //年 ,		11-2
    if (m1==0) {
      m1=11;
    }
    zg[11]|=(ZF[m1*8+i]<<1);    //m1 3位	11-7
    zg[12]|=(ZF[m0*8+i]<<4);    //m9 5	12-4

    zr[12]|=(HZ[9*8+i]>>1);     //月 前4位	12-8 后5列
    zr[13]|=(HZ[9*8+i]<<7);     //月 后1位	13-11
    if (d1==0) {
      d1=11;
    }
    zg[13]|=(ZF[d1*8+i]<<2);    //d1 前3位	13-76   前5列
    zg[13]|=(ZF[d0*8+i]>>3);    //d0  		14-5
    zg[14]|=(ZF[d0*8+i]<<5);    //d0  		14 3

    zr[14]|=(HZ[8*8+i]);        //日 后4位	14-88
    zg[15]|=HZ[(wk-0)*8+i];     //week		15-3~15-8
  }   //i<8
}

void DispYinli(u8 i)
{
  u8 j;
  u16 tmp;

  j=i-8;
  //Get_yinli();
  if (f1>=2) {
    zg[8]|=HZ[7*8+j]; //农后5列   8-77
    if (nm1==0) {
      nm1=11;
    }
    zr[9]|=(ZF[nm1*8+j]<<4); //nm1  5位	9-4
    zr[9]|=(ZF[nm0*8+j]>>1); //nm0 前2位 9-8
    zr[10]|=(ZF[nm0*8+j]<<7); //nm0 后3位 10-1
    zg[10]|=(HZ[9*8+j]<<1); //月 前1位 10-7
    if (nd1==0) {
      nd1=11;
    }
    zr[11]|=(ZF[nd1*8+j]<<4); //d1 前4位 10-8
    zr[11]|=(ZF[nd0*8+j]>>1); //d0 后1	11-7
    zr[12]|=(ZF[nd0*8+j]<<7); //d0 后1	11-7
    zg[12]|=(HZ[8*8+j]<<2); // 1位	11-8

    if (F_HUB75D_TH_DISP_CHANGE == _DISP_T_) {
      if (Temperature < 0) {
        sign = 1;
        tmp = ~Temperature+1;
      } else {
        tmp = Temperature;
      }
      t1 = tmp/100;
      t0 = tmp%100/10;
      td = tmp%10;
      if (sign == 0) {
        if (t1 == 0x00) {
          t1 = 11; //' '
        }
      } else {
        if (t1 == 0x00) {
          t1 = 12; //'-'
        }
      }
    } else {
      tmp = Humidity;
      t1 = tmp/100;
      t0 = tmp%100/10;
      td = tmp%10;
      if (t1 == 0x00) {
        t1 = 11;
      }
    }

    if (sign==1) {
      if (t1 != 0x00) {
        zr[12]|=(DateD[12][j]>>6); //-	12-6
        zr[13]|=(DateD[12][j]<<2); //-	13-1
      }
    }
    zr[13]|=(DateD[t1][j]>>1); //t1	13-4
    zr[13]|=(DateD[t0][j]>>7); //t0 3	13-8
    zr[14]|=(DateD[t0][j]<<1); //t0 2	14-4
    zr[14]|=(DateD[13][j]>>4); //. `   14-5
    zg[14]|=(DateD[13][j]>>4); // 黄色
    zr[14]|=(DateD[td][j]>>5); //td 3   14-8
    zr[15]|=(DateD[td][j]<<3); //td 2	15-2
    if (F_HUB75D_TH_DISP_CHANGE == _DISP_T_) {
      zg[15]|=(DateD[14][j]>>3); // C
    } else {
      zg[15]|=(DateD[15][j]>>3); // %
    }
  } else {
    zr[8]|=HZ[7*8+j]; //农后5列   8-77
    if (nm1==0) {
      nm1=11;
    }
    zg[9]|=(ZF[nm1*8+j]<<4); //nm1  5位 9-4
    zg[9]|=(ZF[nm0*8+j]>>1); //nm0 前2位 9-8
    zg[10]|=(ZF[nm0*8+j]<<7); //nm0 后3位 10-1
    zr[10]|=(HZ[9*8+j]<<1); //月 前1位 10-7
    if (nd1==0) {
      nd1=11;
    }
    zg[11]|=(ZF[nd1*8+j]<<4); //d1 前4位 10-8
    zg[11]|=(ZF[nd0*8+j]>>1); //d0 后1 11-7
    zg[12]|=(ZF[nd0*8+j]<<7); //d0 后1 11-7
    zr[12]|=(HZ[8*8+j]<<2); //日 前1位 11-8

    if (F_HUB75D_TH_DISP_CHANGE == _DISP_T_) {
      if (Temperature < 0) {
        sign = 1;
        tmp = ~Temperature+1;
      } else {
        tmp = Temperature;
      }
      t1 = tmp/100;
      t0 = tmp%100/10;
      td = tmp%10;
      if (sign == 0) {
        if (t1 == 0x00) {
          t1 = 11; //' '
        }
      } else {
        if (t1 == 0x00) {
          t1 = 12; //'-'
        }
      }
    } else {
      tmp = Humidity;
      t1 = tmp/100;
      t0 = tmp%100/10;
      td = tmp%10;
      if (t1 == 0x00) {
        t1 = 11;
      }
    }

    if (sign==1) {
      if (t1 != 0x00) {
        zg[12]|=(DateD[12][j]>>6); //- 12-6
        zg[13]|=(DateD[12][j]<<2); //- 13-1
      }
    }
    zg[13]|=(DateD[t1][j]>>1); //t1 13-4
    zg[13]|=(DateD[t0][j]>>7); //t0 3 13-8
    zg[14]|=(DateD[t0][j]<<1); //t0 2 14-4
    zr[14]|=(DateD[13][j]>>4); //. `   14-5
    zg[14]|=(DateD[td][j]>>5); //td 3   14-8
    zg[15]|=(DateD[td][j]<<3); //td 2 15-2
    if (F_HUB75D_TH_DISP_CHANGE == _DISP_T_) {
      zr[15]|=(DateD[14][j]>>3); //C
    } else {
      zr[15]|=(DateD[15][j]>>3); //%
    }
  } //>8
}

void HUB75D_CalcClock(rtc_counter_value_t *time)
{
  static u8 i;

  i++;
  if (i > 4) {
    i = 0x00;
    if (F_HUB75D_TH_DISP_CHANGE == _DISP_T_) {
      F_HUB75D_TH_DISP_CHANGE = _DISP_H_;
    } else {
      F_HUB75D_TH_DISP_CHANGE = _DISP_T_;
    }
  }

  h0 = time->hour%10;
  h1 = time->hour/10;
  f0 = time->min%10;
  f1 = time->min/10;
  s0 = time->sec%10;
  s1 = time->sec/10;

  d0 = time->day%10;
  d1 = time->day/10;
  m0 = time->month%10;
  m1 = time->month/10;
  y0 = time->year%100%10;
  y1 = time->year%100/10;
  wk = time->week;
  sd = 11;//":"
}

void HUB75D_DispScan(void)
{
    static u8 i;
    u8 k,x;

    DispTime(i);
    if (i<8) {
        DispDate(i);
    } else {
        DispYinli(i);
    }

    HUB_LAT=0;
    HUB_OE=1;
    for (k=0; k<8; k++)
    {
      for (x=0; x<8; x++)
      {
        if (zr[k+8] & 0x80) {
            HUB_R1 = 1;
        } else {
            HUB_R1 = 0;
        }
        if (zg[k+8] & 0x80) {
            HUB_G1 = 1;
        } else {
            HUB_G1 = 0;
        }
        if (zb[k+8] & 0x80) {
            HUB_B1 = 1;
        } else {
            HUB_B1 = 0;
        }

        if (zr[k] & 0x80) {
            HUB_R2 = 1;
        } else {
            HUB_R2 = 0;
        }
        if (zg[k] & 0x80) {
            HUB_G2 = 1;
        } else {
            HUB_G2 = 0;
        }
        if (zb[k] & 0x80) {
            HUB_B2 = 1;
        } else {
            HUB_B2 = 0;
        }

        zr[k+8] = zr[k+8] << 1;
        zg[k+8] = zg[k+8] << 1;
        zb[k+8] = zb[k+8] << 1;
        zr[k] = zr[k] << 1;
        zg[k] = zg[k] << 1;
        zb[k] = zb[k] << 1;
        HUB_CLK=1;
        HUB_CLK=0;
      }
    }

    if (i&0x01) {
        HUB_A = 1;
    } else {
        HUB_A = 0;
    }
    if (i&0x02) {
        HUB_B = 1;
    } else {
        HUB_B = 0;
    }
    if (i&0x04) {
        HUB_C = 1;
    } else {
        HUB_C = 0;
    }
    if (i&0x08) {
        HUB_D = 1;
    } else {
        HUB_D = 0;
    }

    HUB_LAT=1;
    HUB_OE=0;

    i++;
    if (i > 15) {
        i = 0x00;
    }
}

void HUB75D_DispOnOff(HUB75D_DispOnOffFlag F_tmp)
{
  if (F_tmp == _DISP_ON_) {
    HUB75D_DISP_POWER_PIN = _DISP_ON_;
    F_HUB75D_DISP_ON_OFF = _DISP_ON_;
    HUB75D_DispOffCtr = _DISP_OFF_TIME_5MIN_;
  } else {
    HUB75D_DISP_POWER_PIN = _DISP_OFF_;
    F_HUB75D_DISP_ON_OFF = _DISP_OFF_;
    HUB75D_DispOffCtr = 0x00;
    HUB_A = 0;
    HUB_B = 0;
    HUB_C = 0;
    HUB_D = 0;
    HUB_OE = 0;
    HUB_LAT = 0;
    HUB_CLK = 0;
    HUB_R1 = 0;
    HUB_G1 = 0;
    HUB_B1 = 0;
    HUB_R2 = 0;
    HUB_G2 = 0;
    HUB_B2 = 0;
  }
}

void HUB75D_CtrDec(void)
{
  if (HUB75D_DispOffCtr) {
    HUB75D_DispOffCtr--;
    if (HUB75D_DispOffCtr == 0x00) {
      EnterStandbyMode();
    }
  }
}
